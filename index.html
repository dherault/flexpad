<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
    <link rel="stylesheet" href="/flexpad.css">
    <link rel="stylesheet" href="/flexpad/flexpad.css">

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: sans-serif;
        font-size: 20px;
        min-height: 100vh;
        text-align: center;
        color: SlateGray;
      }
      h1 {
        margin: 40px 0 35px 0;
        color: GoldenRod;
      }
      a {
        color: GoldenRod;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      footer {
        width: 370px;
        margin: 35px 0 40px 0;
        text-align: center;
      }
      nav {
        width: 745px;
      }
      article {
        max-width: 612px;
        margin-top: 20px;
        flex-grow: 1;
      }
      section {
        display: block;
        margin: 5px 15px 0 15px;
      }
      label {
        display: block;
        width: 100%;
        font-size: 24px;
        font-weight: bold;
        font-family: monospace;
        text-align: center;
        color: GoldenRod;
      }
      input {
        min-width: 180px;
        margin: 0 5px;
      }
      button {
        cursor: pointer;
        min-width: 50px;
        min-height: 50px;
        background-color: white;
        padding: 10px;
        border: 2px solid SlateGray;
        margin: 0px 5px;
        font-family: monospace;
        color: SlateGray;
      }
      button:focus, input:focus {
        outline: none;
      }
      .buttons {
        padding: 0;
        width: 54px;
        max-width: 60px;
        min-height: : 60px;
        border: 2px solid SlateGray;
      }
      .buttons .button-active:nth-child(0) {
        border-color:
      }
      .separator {
        width: 2px;
        background-color: SlateGray;
        height: 46px;
        margin: 0 5px;
      }
      .buttons button, .zero {
        padding: 0;
        width: 25px;
        height: 25px;
        min-width: 25px;
        min-height: 25px;
        margin: 0;
        border: none;
        font-size: 16px;
      }
      .zero {
        margin-top: 5px;
        border: 2px solid SlateGray;
      }
      .button-active {
        font-weight: bold;
        color: GoldenRod;
        border-color: GoldenRod;
      }
      .lock {
        border: none;
      }
      .lock-x {
        border-top: 2px solid SlateGray;
        border-bottom: 2px solid SlateGray;
      }
      .lock-y {
        border-left: 2px solid SlateGray;
        border-right: 2px solid SlateGray;
      }
      .container {
        margin-top: 3px;
        padding: 1px;
        background-color: rgba(238, 238, 238, 0.25);
        border: 2px solid rgba(238, 238, 238, 0.30);
      }
      .y-locked {
        height: 174px;
      }
      .x-locked {
        width: 174px;
      }
      .box {
        min-width: 40px;
        min-height: 40px;
        margin: 1px;
        border: 2px solid SlateGray;
        font-size: 16px;
        font-weight: bold;
      }
      .grow {
        flex-grow: 1;
      }
    </style>

    <title>Flexpad</title>

  </head>
  <body class="y8">

    <h1>Flexpad</h1>

    <nav class="x57b">

      <div class="x47">
        <button class="button-active" title="X axis">x</button>
        <button title="Y axis">y</button>
        <div class="separator"></div>
        <button title="spacing: around">a</button>
        <button title="spacing: between">b</button>
        <div class="separator"></div>
        <button title="stretch">s</button>
      </div>

      <div class="y8">
        <div id="wrap-origin" class="x57 buttons" title="wrap origin">
          <button>‚åú</button>
          <button>‚åù</button>
          <button>‚åû</button>
          <button>‚åü</button>
        </div>

        <button class="zero" title="nowrap reverse">0</button>
      </div>

      <div class="x47">
        <button class="lock" title="lock dimensions">üîí</button>
        <button title="grow children">‚Üπ</button>
      </div>


      <div class="y8">
        <input type="range" min="1" max="20" value="3" title="number of children"/>
        <input type="range" min="1" max="5" value="4" title="children width" />
      </div>

    </nav>

    <article class="x87">

      <section id="7">
        <label></label>
        <div></div>
      </section>
      <section id="8">
        <label></label>
        <div></div>
      </section>
      <section id="9">
        <label></label>
        <div></div>
      </section>
      <section id="4">
        <label></label>
        <div></div>
      </section>
      <section id="5">
        <label></label>
        <div></div>
      </section>
      <section id="6">
        <label></label>
        <div></div>
      </section>
      <section id="1">
        <label></label>
        <div></div>
      </section>
      <section id="2">
        <label></label>
        <div></div>
      </section>
      <section id="3">
        <label></label>
        <div></div>
      </section>

    </article>

    <footer class="x8b">
      <a href="https://github.com/dherault/flexpad" target="_blank">Documentation</a>
      <a href="https://raw.githubusercontent.com/dherault/flexpad/master/flexpad.css" target="_blank">CSS file</a>
      <a href="https://github.com/dherault/flexpad/blob/master/LICENSE" target="_blank">MIT License</a>
    </footer>

    <script>
      const [bX, bY, bA, bB, bS, btl, btr, bbl, bbr, br, bLock, bGrow] = document.getElementsByTagName('button')
      const [sliderN, sliderR] = document.getElementsByTagName('input')
      const divWrap = document.getElementById('wrap-origin');

      const sections = []
      for (let i = 1; i < 10; i++) sections.push(document.getElementById(i))

      const traverseSections = fn => {
        for (let i = 1; i < 10; i++) fn(document.getElementById(i), i)
      }

      const activateButton = (el, bool) => el.classList[bool ? 'add' : 'remove']('button-active')
      const activateButtonLock = (bool, x) => bLock.classList[bool ? 'add' : 'remove']('lock-' + (x ? 'x' : 'y'));

      const dToI = d => ({ tl: 7, tr: 9, bl: 1, br: 3, r: '0' })[d]

      const state = {
        d: '',
        x: true,
        n: 3,
        xLocked: true,
        yLocked: true,
        lockIndex: 0,
        /*  y »≥
          x 0 1
          xÃÑ 2 3
        */
      }

      function render() {
        const { x, a, b, s, d, grow, xLocked, yLocked } = state

        traverseSections((section, i) => {
          let className = `${x ? 'x' : 'y'}${i}${dToI(d) || ''}`

          if (a) className += 'a'
          if (b) className += 'b'
          if (s) className += 's'

          section.children[0].innerText = className
          section.children[1].className = `${className}${xLocked ? ' x-locked' : ''}${yLocked ? ' y-locked' : ''} container`
        })

        activateButton(bX, x)
        activateButton(bY, !x)
        activateButton(bA, a)
        activateButton(bB, b)
        activateButton(bS, s)
        activateButton(btl, d === 'tl')
        activateButton(btr, d === 'tr')
        activateButton(bbl, d === 'bl')
        activateButton(bbr, d === 'br')
        activateButton(br, d === 'r')
        activateButtonLock(xLocked, true)
        activateButtonLock(yLocked, false)
        divWrap.style.borderTopColor = d[0] === 't' ? 'GoldenRod' : 'SlateGray';
        divWrap.style.borderRightColor = d[1] === 'r' ? 'GoldenRod' : 'SlateGray';
        divWrap.style.borderBottomColor = d[0] === 'b' ? 'GoldenRod' : 'SlateGray';
        divWrap.style.borderLeftColor = d[1] === 'l' ? 'GoldenRod' : 'SlateGray';
      }

      const onclick = ((el, fn) => el.onclick = () => fn() + '' && render())

      onclick(bX, () => state.x = true)
      onclick(bY, () => state.x = false)
      onclick(bA, () => (state.a = !state.a) + '' && (state.b = false))
      onclick(bB, () => (state.b = !state.b) + '' && (state.a = false))
      onclick(bS, () => state.s = !state.s)
      onclick(btl, () => state.d = state.d !== 'tl' && 'tl')
      onclick(btr, () => state.d = state.d !== 'tr' && 'tr')
      onclick(bbl, () => state.d = state.d !== 'bl' && 'bl')
      onclick(bbr, () => state.d = state.d !== 'br' && 'br')
      onclick(br, () => state.d = state.d !== 'r' && 'r')

      onclick(bLock, () => {
        const i = (state.lockIndex + 1) % 4

        if (i === 0) state.xLocked = state.yLocked = true
        else if (i === 1) state.xLocked = state.yLocked = false
        else if (i === 2) (state.xLocked = true) && (state.yLocked = false)
        else (state.xLocked = false) || (state.yLocked = true)

        state.lockIndex = i
        render()
      })

      function renderBoxes() {
        const { n, grow } = state

        activateButton(bGrow, grow)

        traverseSections(section => {
          const container = section.children[1]

          while (container.hasChildNodes()) {
            container.removeChild(container.lastChild)
          }

          for (let i = 0; i < n; i++) {
            const box = document.createElement('div')

            box.innerText = i + 1
            box.className = 'x5 box' + (grow ? ' grow' : '')
            container.appendChild(box)
          }
        })
      }

      bGrow.onclick = () => (state.grow = !state.grow) + '' && renderBoxes();

      function handleBoxNumberChange(e, key) {
        const x = e.target.value

        if (state[key] === x) return

        state[key] = x
        renderBoxes()
      }

      sliderN.oninput = e => handleBoxNumberChange(e, 'n')
      sliderN.onchange = e => handleBoxNumberChange(e, 'n')
      sliderR.oninput = e => handleBoxNumberChange(e, 'r')
      sliderR.onchange = e => handleBoxNumberChange(e, 'r')

      renderBoxes()
      render()
    </script>
  </body>
</html>
